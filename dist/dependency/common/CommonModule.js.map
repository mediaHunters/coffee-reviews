{"version":3,"sources":["../../../src/dependency/common/CommonModule.ts","../../../src/dependency/BaseModule.ts","../../../src/infrastructure/database/mappings/DBMapper.ts","../../../src/core/domain/Role/Role.ts","../../../src/core/CoreModuleSymbols.ts","../../../src/infrastructure/InfrastructureModuleSymbols.ts","../../../src/infrastructure/database/mappings/Role/RoleEntityToRoleDomain.ts","../../../src/core/domain/User/User.ts","../../../src/infrastructure/database/mappings/User/UserEntityToUserDomain.ts","../../../src/core/domain/Coffee/Coffee.ts","../../../src/infrastructure/database/mappings/Coffee/CoffeEntityToCoffeeDomain.ts","../../../src/core/domain/Review/Review.ts","../../../src/infrastructure/database/mappings/Review/ReviewEntityToReviewDomain.ts","../../../src/infrastructure/database/orm/CROrm.ts","../../../src/ui/common/mappings/UIMapper.ts","../../../src/ui/UIModuleSymbols.ts","../../../src/ui/common/mappings/User/UserDomainToUserUI.ts"],"sourcesContent":["import { interfaces } from 'inversify';\n\nimport { BaseModule } from 'dependency/BaseModule';\n\nimport { DBMapper } from 'infrastructure/database/mappings/DBMapper';\nimport { CROrm } from 'infrastructure/database/orm/CROrm';\nimport { IOrm } from 'infrastructure/database/orm/IOrm';\n\nimport {\n  DATABASE_IDENTIFIERS,\n  INFRASTRUCTURE_IDENTIFIERS,\n} from 'infrastructure/InfrastructureModuleSymbols';\n\nimport { UIMapper } from 'ui/common/mappings/UIMapper';\nimport { UI_IDENTIFIERS } from 'ui/UIModuleSymbols';\n\nexport class CommonModule extends BaseModule {\n  constructor() {\n    super((bind: interfaces.Bind) => {\n      this.init(bind);\n    });\n  }\n\n  public init(bind: interfaces.Bind): void {\n    this.provideOrm(bind);\n\n    this.provideDBMapper(bind);\n    this.provideUIMapper(bind);\n  }\n\n  private provideUIMapper(bind: interfaces.Bind): void {\n    bind<UIMapper>(UI_IDENTIFIERS.UI_MAPPER).to(UIMapper);\n  }\n\n  private provideDBMapper(bind: interfaces.Bind): void {\n    bind<DBMapper>(INFRASTRUCTURE_IDENTIFIERS.DB_MAPPER).to(DBMapper);\n  }\n\n  private provideOrm(bind: interfaces.Bind): void {\n    bind<IOrm>(DATABASE_IDENTIFIERS.ORM).to(CROrm);\n  }\n}\n","import { ContainerModule, interfaces } from 'inversify';\n\nexport abstract class BaseModule extends ContainerModule {\n  public abstract init(bind: interfaces.Bind): void;\n}\n","import { Mapper } from '@wufe/mapper';\nimport { IMapperConfiguration } from '@wufe/mapper/types/conf/mapper.configuration';\n\nimport { injectable } from 'inversify';\n\nimport { RoleEntityToRoleDomain } from 'infrastructure/database/mappings/Role/RoleEntityToRoleDomain';\nimport { UserEntityToUserDomain } from 'infrastructure/database/mappings/User/UserEntityToUserDomain';\nimport { CoffeeEntityToCoffeeDomain } from 'infrastructure/database/mappings/Coffee/CoffeEntityToCoffeeDomain';\nimport { ReviewEntityToReviewDomain } from 'infrastructure/database/mappings/Review/ReviewEntityToReviewDomain';\n\n@injectable()\nexport class DBMapper {\n  public readonly mapper: Mapper;\n\n  constructor() {\n    this.mapper = new Mapper().withConfiguration(\n      (configuration: IMapperConfiguration) =>\n        configuration\n          .shouldIgnoreSourcePropertiesIfNotInDestination(true)\n          .shouldAutomaticallyMapArrays(true)\n    );\n\n    this.initialize();\n  }\n\n  private initialize(): void {\n    UserEntityToUserDomain().configureMapping(this.mapper);\n    RoleEntityToRoleDomain().configureMapping(this.mapper);\n    CoffeeEntityToCoffeeDomain().configureMapping(this.mapper);\n    ReviewEntityToReviewDomain().configureMapping(this.mapper);\n  }\n}\n","export class Role {\n  constructor(public readonly id: string, public readonly name: string) {}\n}\n","export const DOMAIN_APPLICATION_SERVICE_IDENTIFIERS = {\n  USER_SERVICE: Symbol.for('UserService'),\n  AUTHENTICATION_SERVICE: Symbol.for('AuthenticationService'),\n  COFFEE_SERVICE: Symbol.for('CoffeeService'),\n  REVIEW_SERVICE: Symbol.for('ReviewService'),\n};\n\nexport const DOMAIN_MAPPING_IDENTIFIERS = {\n  USER_DOMAIN: Symbol.for('UserDomain'),\n  ROLE_DOMAIN: Symbol.for('RoleDomain'),\n  COFFEE_DOMAIN: Symbol.for('CoffeeDomain'),\n  REVIEW_DOMAIN: Symbol.for('ReviewDomain'),\n};\n\nexport const DOMAIN_REPOSITORY_IDENTIFIERS = {\n  ROLE_REPOSITORY: Symbol.for('RoleRepository'),\n  USER_REPOSITORY: Symbol.for('UserRepository'),\n  COFFEE_REPOSITORY: Symbol.for('CoffeeRepository'),\n  REVIEW_REPOSITORY: Symbol.for('ReviewRepository'),\n};\n\nexport const DOMAIN_UNIT_OF_WORK_IDENTIFIERS = {\n  USER_UNIT_OF_WORK: Symbol.for('UserUnitOfWork'),\n  COFFEE_UNIT_OF_WORK: Symbol.for('CoffeeUnitOfWork'),\n};\n","export const DATABASE_IDENTIFIERS = {\n  ORM: Symbol.for('Orm'),\n};\n\nexport const INFRASTRUCTURE_IDENTIFIERS = {\n  DB_MAPPER: Symbol.for('DBMapper'),\n};\n\nexport const DATABASE_MAPPING_IDENTIFIERS = {\n  USER_ENTITY: Symbol.for('UserEntity'),\n  ROLE_ENTITY: Symbol.for('RoleEntity'),\n  COFFEE_ENTITY: Symbol.for('CoffeeEntity'),\n  REVIEW_ENTITY: Symbol.for('ReviewEntity'),\n};\n","import { Mapper } from '@wufe/mapper';\n\nimport { IMapping } from 'core/common/mapper/IMapping';\nimport { Role } from 'core/domain/Role/Role';\nimport { DOMAIN_MAPPING_IDENTIFIERS } from 'core/CoreModuleSymbols';\nimport { DATABASE_MAPPING_IDENTIFIERS } from 'infrastructure/InfrastructureModuleSymbols';\nimport { Role as RoleEntity } from 'infrastructure/database/entities/Role';\n\nexport const RoleEntityToRoleDomain = (): IMapping => ({\n  configureMapping(mapper: Mapper): void {\n    mapper.createMap<RoleEntity, Role>(\n      {\n        destination: DOMAIN_MAPPING_IDENTIFIERS.ROLE_DOMAIN,\n        source: DATABASE_MAPPING_IDENTIFIERS.ROLE_ENTITY,\n      },\n      Role\n    );\n  },\n});\n","export class User {\n  constructor(\n    public readonly id: string,\n    public readonly nickname: string,\n    public readonly email: string,\n    public readonly role: string,\n    public readonly password: string,\n    public readonly lastName?: string,\n    public readonly firstName?: string\n  ) {}\n}\n","import { Mapper } from '@wufe/mapper';\n\nimport { IMapping } from 'core/common/mapper/IMapping';\n\nimport { DOMAIN_MAPPING_IDENTIFIERS } from 'core/CoreModuleSymbols';\n\nimport { User } from 'core/domain/User/User';\nimport { User as UserEntity } from 'infrastructure/database/entities/User';\n\nimport { DATABASE_MAPPING_IDENTIFIERS } from 'infrastructure/InfrastructureModuleSymbols';\n\nexport const UserEntityToUserDomain = (): IMapping => ({\n  configureMapping(mapper: Mapper): void {\n    mapper\n      .createMap<UserEntity, User>(\n        {\n          destination: DOMAIN_MAPPING_IDENTIFIERS.USER_DOMAIN,\n          source: DATABASE_MAPPING_IDENTIFIERS.USER_ENTITY,\n        },\n        User\n      )\n      .forMember('role', (opt) => opt.mapFrom((src) => src.role.name));\n  },\n});\n","export class Coffee {\n  constructor(\n    public readonly id: string,\n    public readonly brand: string,\n    public readonly name: string,\n    public readonly type: string,\n    public readonly imgUrl: string,\n    public readonly description: string,\n    public readonly burntLvl: string,\n    public readonly createdAt: Date,\n    public readonly reviews: number,\n    public readonly reflink: string\n  ) {}\n}\n","import { Mapper } from '@wufe/mapper';\n\nimport { IMapping } from 'core/common/mapper/IMapping';\n\nimport { DOMAIN_MAPPING_IDENTIFIERS } from 'core/CoreModuleSymbols';\nimport { Coffee } from 'core/domain/Coffee/Coffee';\n\nimport { Coffee as CoffeeEntity } from 'infrastructure/database/entities/Coffee';\nimport { DATABASE_MAPPING_IDENTIFIERS } from 'infrastructure/InfrastructureModuleSymbols';\n\nexport const CoffeeEntityToCoffeeDomain = (): IMapping => ({\n  configureMapping(mapper: Mapper): void {\n    mapper.createMap<CoffeeEntity, Coffee>(\n      {\n        destination: DOMAIN_MAPPING_IDENTIFIERS.COFFEE_DOMAIN,\n        source: DATABASE_MAPPING_IDENTIFIERS.COFFEE_ENTITY,\n      },\n      Coffee\n    );\n  },\n});\n","export class Review {\n  constructor(\n    public readonly id: string,\n    public readonly look: number,\n    public readonly smell: number,\n    public readonly taste: number,\n    public readonly rating: number,\n    public readonly coffeeId: string,\n    public readonly userId: string\n  ) {}\n}\n","import { Mapper } from '@wufe/mapper';\n\nimport { IMapping } from 'core/common/mapper/IMapping';\nimport { DOMAIN_MAPPING_IDENTIFIERS } from 'core/CoreModuleSymbols';\nimport { Review } from 'core/domain/Review/Review';\nimport { Review as ReviewEntity } from 'infrastructure/database/entities/Review';\nimport { DATABASE_MAPPING_IDENTIFIERS } from 'infrastructure/InfrastructureModuleSymbols';\n\nexport const ReviewEntityToReviewDomain = (): IMapping => ({\n  configureMapping(mapper: Mapper): void {\n    mapper.createMap<ReviewEntity, Review>(\n      {\n        destination: DOMAIN_MAPPING_IDENTIFIERS.REVIEW_DOMAIN,\n        source: DATABASE_MAPPING_IDENTIFIERS.REVIEW_ENTITY,\n      },\n      Review\n    );\n  },\n});\n","import { injectable } from 'inversify';\nimport { createConnection } from 'typeorm';\n\nimport {\n  initializeTransactionalContext,\n  patchTypeORMRepositoryWithBaseRepository,\n} from 'typeorm-transactional-cls-hooked';\n\nimport { IOrm } from 'infrastructure/database/orm/IOrm';\n\n@injectable()\nexport class CROrm implements IOrm {\n  public async initialize(): Promise<void> {\n    await createConnection(process.env.ORM_CONNECTION || '');\n\n    initializeTransactionalContext();\n    patchTypeORMRepositoryWithBaseRepository();\n  }\n}\n","import { injectable } from 'inversify';\nimport { Mapper } from '@wufe/mapper';\n\nimport { UserDomainToUserUI } from 'ui/common/mappings/User/UserDomainToUserUI';\n\n@injectable()\nexport class UIMapper {\n  public readonly mapper: Mapper;\n\n  constructor() {\n    this.mapper = new Mapper().withConfiguration((configuration) =>\n      configuration\n        .shouldIgnoreSourcePropertiesIfNotInDestination(true)\n        .shouldAutomaticallyMapArrays(true)\n    );\n\n    this.initialize();\n  }\n\n  private initialize(): void {\n    UserDomainToUserUI().configureMapping(this.mapper);\n  }\n}\n","export const UI_IDENTIFIERS = {\n  UI_MAPPER: Symbol.for('UIMapper'),\n};\n\nexport const UI_APPLICATION_IDENTIFIERS = {\n  EXPRESS: Symbol.for('Express'),\n  EXPRESS_ROUTER: Symbol.for('ExpressRouter'),\n\n  EXPRESS_APPLICATION: Symbol.for('ExpressApplication'),\n  INVERSIFY_APPLICATION: Symbol.for('InversifyExpressApplication'),\n  JWT_TOKEN_UTIL: Symbol.for('JWTTokenUtil'),\n  JWT_AUTHENTICATION_HANDLER: Symbol.for('JWTAuthenticationHandler'),\n\n  LOGGER: Symbol.for('Logger'),\n  LOGGER_FORMAT: Symbol.for('WinstonFormat'),\n  LOGGER_WINSTON: Symbol.for('WinstonLogger'),\n};\n\nexport const UI_MAPPINGS_IDENTIFIERS = {\n  USER_UI: Symbol.for('UserUI'),\n};\n","import { Mapper } from '@wufe/mapper';\n\nimport { IMapping } from 'core/common/mapper/IMapping';\n\nimport { User } from 'core/domain/User/User';\nimport { DOMAIN_MAPPING_IDENTIFIERS } from 'core/CoreModuleSymbols';\n\nimport { User as UserUI } from 'ui/common/models/User';\nimport { UI_MAPPINGS_IDENTIFIERS } from 'ui/UIModuleSymbols';\n\nexport const UserDomainToUserUI = (): IMapping => ({\n  configureMapping(mapper: Mapper): void {\n    mapper.createMap<User, UserUI>(\n      {\n        destination: UI_MAPPINGS_IDENTIFIERS.USER_UI,\n        source: DOMAIN_MAPPING_IDENTIFIERS.USER_DOMAIN,\n      },\n      User\n    );\n  },\n});\n"],"mappings":"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","names":["import_inversify","import_inversify","import_inversify","import_mapper"]}